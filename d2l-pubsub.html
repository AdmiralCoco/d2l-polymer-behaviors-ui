<script>
(function() {
	'use strict';

	var PubSub = {

        subscribe: function(channel, subscriber) {

            if (!window.D2L.PubSub._channels[channel]) {
                window.D2L.PubSub._channels[channel] = [];
                console.log('Created channel ' + channel);
            } else {
                console.log('Channel ' + channel + ' already exists');
            }

            window.D2L.PubSub._channels[channel].push(subscriber);

            console.log('Channel subscriber added.');
        },

		publish: function(channel, message) {

            if (window.D2L.PubSub._channels[channel]) {
                console.log('Publishing message for channel ' + channel);
                
                window.D2L.PubSub._channels[channel].forEach(function(subscriber) {
                    if (typeof subscriber === 'function') {
                        setTimeout(function() {
                            subscriber(message);
                        }, 0);
                    }
                });
            }
		},

        _channels: {}

	};

	window.D2L = window.D2L || {};
	window.D2L.PubSub =  window.D2L.PubSub || PubSub;

})();
</script>
